<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>äº‹å‰ç²¾ç®—ï½œå®Œäº†</title>

<style>
:root {
	--bg: #fdf5e6;
	--panel: #fffaf0;
	--text: #444;
	--line: #d8c49b;
	--accent: #d6b85a;
	--hover: #f8efd0;
	--muted: #666;
	--ok: #2e7d32;
}

* {
	box-sizing: border-box;
}

html, body {
	height: 100%;
	margin: 0;
	padding: 0;
}

body {
	background: var(--bg);
	color: var(--text);
	font-family: 'Noto Sans JP', 'Malgun Gothic', sans-serif;
	display: flex;
	flex-direction: column;
}

/* Topbar */
.topbar {
	display: flex;
	justify-content: space-between;
	align-items: center;
	padding: 14px 22px;
	background: var(--panel);
	border-bottom: 2px solid var(--line);
}

.actions {
	display: flex;
	gap: 12px;
	align-items: center;
}

.link-btn {
	border: 2px solid var(--line);
	border-radius: 12px;
	background: var(--bg);
	color: inherit;
	text-decoration: none;
	font-weight: 800;
	cursor: pointer;
	padding: 10px 16px;
	font-size: 16px;
}

.link-btn:hover {
	background: var(--hover);
}

.title {
	font-weight: 900;
	font-size: clamp(18px, 2.2vw, 22px);
}

/* Layout */
.main-wrap {
	flex: 1;
	display: grid;
	gap: 18px;
	padding: 18px;
	grid-template-columns: 1fr 1fr;
	align-items: stretch;
}

@media ( max-width : 980px) {
	.main-wrap {
		grid-template-columns: 1fr;
	}
}

/* Cards */
.card {
	background: var(--panel);
	border: 2px solid var(--line);
	border-radius: 16px;
	padding: 22px;
	box-shadow: 0 4px 10px rgba(0, 0, 0, .08);
	display: flex;
	flex-direction: column;
	min-height: 0;
}

/* Left */
.left-box {
	align-items: center;
	justify-content: center;
	gap: 18px;
	text-align: center;
}

.left-box h1 {
	margin: 0;
	color: var(--ok);
	font-weight: 900;
	letter-spacing: .02em;
	font-size: clamp(26px, 3.2vw, 40px);
}

.left-box p {
	margin: 0;
	color: var(--muted);
	line-height: 1.6;
	font-size: clamp(16px, 2vw, 20px);
}

/* Right / Receipt */
.right-box {
	align-items: center;
	gap: 18px;
}

.right-box h2 {
	margin: 0;
	font-weight: 900;
	text-align: center;
	font-size: clamp(20px, 2.4vw, 26px);
}

.k-btn {
	border: 2px solid var(--line);
	border-radius: 12px;
	background: var(--accent);
	color: #fff;
	font-weight: 900;
	cursor: pointer;
	padding: 14px 18px;
	font-size: clamp(18px, 2.2vw, 22px);
	width: 100%;
}

.k-btn:hover {
	background: #caaa45;
}

.receipt {
	width: min(96%, 560px);
	background: #fff;
	border: 2px solid var(--line);
	border-radius: 12px;
	padding: 18px 20px;
	display: none;
	font-size: clamp(14px, 1.9vw, 18px);
	line-height: 1.7;
}

.receipt h3 {
	margin: 0 0 12px 0;
	text-align: center;
	font-size: clamp(18px, 2.2vw, 22px);
}

.receipt hr {
	border: none;
	border-top: 1px dashed var(--line);
	margin: 10px 0;
}

.receipt p {
	margin: 6px 0;
	display: flex;
	justify-content: space-between;
	gap: 12px;
}

.receipt p b {
	font-weight: 900;
}

@media print {
	.topbar, #btnReceipt {
		display: none;
	}
	.receipt {
		display: block !important;
		width: 100%;
		border: none;
	}
}
</style>
</head>
<body>
	<!-- ìƒë‹¨ë°” -->
	<div class="topbar">
		<div class="actions">
			<a href="/kiosk/step1" class="link-btn" id="btnHome">ğŸ  ãƒ›ãƒ¼ãƒ </a>

			<!--
              â˜… ë’¤ë¡œê°€ê¸° ë¶„ê¸° ë¡œì§

              - tx != null  : ìœ ë£Œ íë¦„(step4 â†’ step5)
                             â†’ ë‹¤ì‹œ step4ë¡œ (txë¡œ ë³µêµ¬)
              - tx == null  : ë¬´ë£Œ íë¦„(step3 â†’ step5)
                             â†’ ë‹¤ì‹œ step3ë¡œ
            -->
			<a class="link-btn" th:if="${tx != null}"
				th:href="@{/kiosk/step4(tx=${tx})}" id="btnBackStep4">â† æˆ»ã‚‹</a> <a
				class="link-btn" th:if="${tx == null}"
				th:href="@{/kiosk/step3(carId=${carId})}" id="btnBackStep3">â† æˆ»ã‚‹</a>
		</div>
		<div class="title" id="titleText">ç²¾ç®—å®Œäº†</div>
		<div class="actions">
			<button type="button" class="link-btn" id="btnLang">English</button>
		</div>
	</div>

	<!-- ë³¸ë¬¸ -->
	<main class="main-wrap">
		<section class="card left-box">
			<h1 id="msgTitle">ç²¾ç®—ãŒå®Œäº†ã—ã¾ã—ãŸã€‚</h1>
			<p id="msgText">ã”åˆ©ç”¨ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸã€‚ãƒãƒ¼ãŒé–‹ãã¾ã—ãŸã‚‰å®‰å…¨ã«ã”å‡ºåº«ãã ã•ã„ã€‚</p>
		</section>

		<section class="card right-box">
			<h2 id="receiptTitle">é ˜åæ›¸ã®ç™ºè¡Œ</h2>
			<button class="k-btn" id="btnReceipt">é ˜åæ›¸ã‚’è¡¨ç¤º</button>

			<div class="receipt" id="receiptBox">
				<h3 id="rHeader">é ˜åæ›¸ (RECEIPT)</h3>
				<hr />
				<p>
					<span>æ—¥ä»˜</span><span id="rDate"></span>
				</p>
				<p>
					<span>ãƒŠãƒ³ãƒãƒ¼</span><span id="rPlate" th:text="${plate}">â€”</span>
				</p>
				<p>
					<span>å…¥åº«æ™‚åˆ»</span><span id="rEntry" th:text="${entryTime}">â€”</span>
				</p>
				<p>
					<span>å‡ºåº«æ™‚åˆ»</span><span id="rExit" th:text="${exitTime}">â€”</span>
				</p>
				<p>
					<span>åˆ©ç”¨æ™‚é–“</span><span id="rDuration" th:text="${useTime}">â€”</span>
				</p>
				<hr />
				<!-- â˜… ê²°ì œ í‘œì‹œ: paidAmount ìš°ì„ , ì—†ìœ¼ë©´ totalFee -->
				<p>
					<span>é§è»Šæ–™é‡‘</span> <span> <b id="rFee"
						th:text="${#numbers.formatInteger((paidAmount != null ? paidAmount : totalFee), 0)}">0</b>
						å††
					</span>
				</p>

				<!-- â˜… ì§€ë¶ˆë°©ë²•: ìœ ë£Œ(tx != null)ì¼ ë•Œë§Œ í‘œì‹œ -->
				<p th:if="${tx != null}">
					<span>ãŠæ”¯æ‰•ã„æ–¹æ³•</span> <span id="rMethod"
						th:text="${paymentMethod} == 'cash' ? 'ç¾é‡‘' : (${paymentMethod} == 'card' ? 'ã‚«ãƒ¼ãƒ‰' : 'é ˜åæ›¸')">â€”</span>
				</p>

				<hr />
				<p style="justify-content: center" id="thanks">ã”åˆ©ç”¨ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸ</p>
			</div>
		</section>
	</main>

	<script>
  (function(){
    // ì–¸ì–´
    let lang = localStorage.getItem('kiosk_lang') || 'ja';
    const i18n = {
      ja:{
        title:"ç²¾ç®—å®Œäº†",home:"ãƒ›ãƒ¼ãƒ ",back:"â† æˆ»ã‚‹",lang:"English",
        msgTitle:"ç²¾ç®—ãŒå®Œäº†ã—ã¾ã—ãŸã€‚",msgText:"ã”åˆ©ç”¨ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸã€‚ãƒãƒ¼ãŒé–‹ãã¾ã—ãŸã‚‰å®‰å…¨ã«ã”å‡ºåº«ãã ã•ã„ã€‚",
        receiptTitle:"é ˜åæ›¸ã®ç™ºè¡Œ",show:"é ˜åæ›¸ã‚’è¡¨ç¤º",hide:"é ˜åæ›¸ã‚’é–‰ã˜ã‚‹",
        rHeader:"é ˜åæ›¸ (RECEIPT)",date:"æ—¥ä»˜",plate:"ãƒŠãƒ³ãƒãƒ¼",entry:"å…¥åº«æ™‚åˆ»",exit:"å‡ºåº«æ™‚åˆ»",duration:"åˆ©ç”¨æ™‚é–“",
        fee:"é§è»Šæ–™é‡‘",method:"ãŠæ”¯æ‰•ã„æ–¹æ³•",cash:"ç¾é‡‘",card:"ã‚«ãƒ¼ãƒ‰",receipt:"é ˜åæ›¸",thanks:"ã”åˆ©ç”¨ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸ"
      },
      en:{
        title:"Payment Complete",home:"Home",back:"â† Back",lang:"æ—¥æœ¬èª",
        msgTitle:"Payment has been completed.",msgText:"Thank you for using our service. Please exit safely when the gate opens.",
        receiptTitle:"Receipt",show:"Show Receipt",hide:"Hide Receipt",
        rHeader:"RECEIPT",date:"Date",plate:"Plate",entry:"Entry Time",exit:"Exit Time",duration:"Duration",
        fee:"Parking Fee",method:"Payment Method",cash:"Cash",card:"Card",receipt:"Receipt",thanks:"Thank you for your visit."
      }
    };

    const btnLang=document.getElementById('btnLang');
    const btnHome=document.getElementById('btnHome');
    const titleText=document.getElementById('titleText');
    const msgTitle=document.getElementById('msgTitle');
    const msgText=document.getElementById('msgText');
    const receiptTitle=document.getElementById('receiptTitle');
    const btnReceipt=document.getElementById('btnReceipt');
    const receiptBox=document.getElementById('receiptBox');
    const rHeader=document.getElementById('rHeader');
    const rDate=document.getElementById('rDate');
    const thanks=document.getElementById('thanks');

    function setLabel(p, text){
      if(!p) return;
      const s=p.querySelector('span:first-child');
      if(s) s.textContent=text;
    }

    function applyLang(){
      const t=i18n[lang];
      titleText.textContent=t.title;
      btnHome.textContent="ğŸ  "+t.home;
      btnLang.textContent=t.lang;
      msgTitle.textContent=t.msgTitle;
      msgText.textContent=t.msgText;
      receiptTitle.textContent=t.receiptTitle;
      btnReceipt.textContent = (receiptBox.style.display==='block') ? t.hide : t.show;
      rHeader.textContent=t.rHeader;

      setLabel(rDate.parentElement,t.date);
      setLabel(document.getElementById('rPlate').parentElement,t.plate);
      setLabel(document.getElementById('rEntry').parentElement,t.entry);
      setLabel(document.getElementById('rExit').parentElement,t.exit);
      setLabel(document.getElementById('rDuration').parentElement,t.duration);
      setLabel(document.getElementById('rFee').parentElement.parentElement,t.fee);

      // rMethodëŠ” ìœ ë£Œ(tx != null)ì¼ ë•Œë§Œ ì¡´ì¬í•˜ë¯€ë¡œ null ì²´í¬
      const rMethodEl = document.getElementById('rMethod');
      if(rMethodEl){
        setLabel(rMethodEl.parentElement,t.method);
        const raw=rMethodEl.textContent.trim().toLowerCase();
        if(raw.includes('cash')||raw==='ç¾é‡‘') rMethodEl.textContent=t.cash;
        else if(raw.includes('card')||raw==='ã‚«ãƒ¼ãƒ‰') rMethodEl.textContent=t.card;
        else rMethodEl.textContent=t.receipt; // ê·¸ ì™¸ëŠ” ì˜ìˆ˜ì¦ í‘œê¸°
      }

      thanks.textContent=t.thanks;
    }

    btnLang.onclick=()=>{
      lang=(lang==='ja'?'en':'ja');
      localStorage.setItem('kiosk_lang',lang);
      applyLang();
    };

    // ë‚ ì§œ
    const now=new Date();
    rDate.textContent =
      now.getFullYear()+"-"+String(now.getMonth()+1).padStart(2,'0')+"-"+String(now.getDate()).padStart(2,'0')+" "+
      String(now.getHours()).padStart(2,'0')+":"+String(now.getMinutes()).padStart(2,'0');

    // ì˜ìˆ˜ì¦ í† ê¸€
    btnReceipt.addEventListener('click',()=>{
      const visible = receiptBox.style.display==='block';
      receiptBox.style.display = visible ? 'none' : 'block';
      btnReceipt.textContent = visible ? i18n[lang].show : i18n[lang].hide;
    });

    applyLang();
  })();
  </script>
</body>
</html>
